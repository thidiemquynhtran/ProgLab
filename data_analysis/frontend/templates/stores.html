{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PizzaToGo Stores</title>
     <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/styles.css' %}"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
   <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
   
</head>
<body>
    <header class="bg-dark text-white text-center py-3">
        <h1>PizzaToGo Stores</h1>
    </header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="index.html">PizzaToGo</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
                    <li class="nav-item"><a class="nav-link" href="stores.html">Stores</a></li>
                    <li class="nav-item"><a class="nav-link" href="customers.html">Customers</a></li>
                    <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <main class="container my-4">
    <div class="text-center">
        <h2>Customer and Stores Distribution</h2>
    </div>
        <h4>Geographical Heatmap</h4>
        <div id="map" style="height: 600px; width: 100%;"></div>
        <h4 id="map-header">Stores Sales by Region</h4>
        <div id="bar-chart-container">
            <canvas id="barChart"></canvas>
        </div>

    </main> 
    <script>
        document.addEventListener("DOMContentLoaded", function() {
        // Initialize the map
        //var map = L.map('map').setView([37.7749, -122.4194], 5);
        var map = L.map('map', {preferCanvas: true}).setView([37.7749, -122.4194], 5, {width: '100%', height: '600px'});

        // Add a tile layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Function to process customer data for heatmap
        function processCustomerData(data) {
            var customerHeatArray = [];

    data.customer_locations.forEach(function(point) {
        var latitude = parseFloat(point.latitude);
        var longitude = parseFloat(point.longitude);
        customerHeatArray.push([latitude, longitude]);
    });

    return customerHeatArray;
}

        // Function to fetch customer data from backend
        function fetchCustomerData() {
            $.ajax({
                url: "/customer-locations/", // Replace with your actual backend URL
                dataType: "json",
                success: function(data) {
                    var customerHeatArray = processCustomerData(data);
                    
                    // Add the customer heatmap layer to the map
                    L.heatLayer(customerHeatArray, {radius: 25, gradient: {0.4: 'blue', 0.65: 'lime', 1: 'red'}}).addTo(map);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("Error fetching customer data:", textStatus, errorThrown);
                    // Handle error appropriately, e.g., display an error message to the user
                }
            });
        }

        // Fetch customer data on page load
        fetchCustomerData();
    });
    </script>
    <footer class="bg-dark text-white text-center py-3">
        <p>&copy; 2024 PizzaToGo</p>
    </footer>
</body>
</html>
